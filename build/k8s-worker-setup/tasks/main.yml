---
# tasks file for k8-worker-setup

- name: Copy a file to a remote server
  copy:
    src: /Users/obinna/Desktop/IU/DEVOP/build/k8s-worker-setup/tasks/join_token
    dest: /home/ubuntu/


- name: Extract join command from file
  command: |
            awk '/kubeadm join/{flag=1} flag{printf "%s", $0; if (/\\$/) printf " "; else {printf "\n"; flag=0}}' /home/ubuntu/join_token
  register: join_command_output

- name: Clean the join command
  set_fact:
    join_command_cleaned: "{{ join_command_output.stdout | regex_replace('\\s+$', '') | regex_replace('\\s+\\\\\\s+', ' ') }}"

- name: Debug the cleaned command
  debug:
    msg: "Cleaned Command: {{ join_command_cleaned }}"

- name: Execute the join command
  shell: "{{ join_command_cleaned }}"
  when: join_command_cleaned != ""
  