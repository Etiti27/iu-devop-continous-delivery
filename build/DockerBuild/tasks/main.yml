---
# tasks file for DockerBuild
    # - name: Run Docker container
      # shell: |
        # apt update -y install
# /Users/obinna/Desktop/IU/DEVOP/build
   
      
 
    - name: Install Docker
      apt:
        name: docker.io
        state: present
      become: true

    - name: Install Ansible
      apt:
        name: ansible
        state: present
      become: true

   


    - name: Ensure Docker service is running
      service:
        name: docker
        state: started
        enabled: yes
      become: true

    # - name: Copy Dockerfile to remote host
      # copy:
        # src: /Users/obinna/Desktop/IU/DEVOP/Dockerfile
        # dest: /home/ubuntu/Dockerfile


  

    - name: Copy large file to remote host
      synchronize:
        src: /Users/obinna/Desktop/IU/DEVOP/webapp
        dest:  /home/ubuntu/
        rsync_opts:
          - "--compress"
          - "--progress"

    
    

    - name: Check if Dockerfile exists
      ansible.builtin.stat:
        path: /home/ubuntu/webapp/Dockerfile
      register: dockerfile_status

    - name: Fail if Dockerfile does not exist
      ansible.builtin.fail:
        msg: "Dockerfile not found!"
      when: not dockerfile_status.stat.exists


    - name: build docker image
      docker_image:
       name: iucicd
       source: build  # <-- add
       build:         # <-- add
        path: /home/ubuntu/webapp/  # <-- move under build:
      force: yes
      tags: latest
   

    
   
    # - name: Build Docker image
      # community.docker.docker_image:
      #  build:
        # context: /home/ubuntu/webapp/       # Directory containing the Dockerfile
        # dockerfile: Dockerfile                # Name of the Dockerfile (if not named 'Dockerfile')
      #  name: web-app         # Name of the Docker image
      #  tag: latest            # Optional: specify a tag
      #  state: present

    

        # - name: Build Docker image
   

    # - name: Build Docker image
      # community.docker.docker_image:
      #  build:
        # context: /home/ubuntu/webapp/       # Directory containing the Dockerfile and any necessary files
        # dockerfile: .              # Specify the Dockerfile if it's not named 'Dockerfile'
      #  name: mycicd                          # Name of the Docker image
      #  tag: latest                           # Optional: specify a tag
      #  state: present

 
    


      
    # - name: Run Docker container
      # shell: |
        # docker run -d --name {{docker_image_name}} -p 3000:3000 {{ docker_image_name }}:{{ docker_image_tag }}
