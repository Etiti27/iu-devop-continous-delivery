---

    - name: Update APT package index
      apt:
        update_cache: yes
 
    - name: Install Docker
      apt:
        name: docker.io
        state: present

    - name: Install Ansible
      apt:
        name: ansible
        state: present
      # become: true

   


    - name: Ensure Docker service is running
      service:
        name: docker
        state: started
        enabled: yes
      # become: true

    # - name: Copy Dockerfile to remote host
      # copy:
        # src: /Users/obinna/Desktop/IU/DEVOP/Dockerfile
        # dest: /home/ubuntu/Dockerfile


    - name: Check if Dockerfile exists
      ansible.builtin.stat:
        path: /Users/obinna/Desktop/IU/DEVOP/webapp/Dockerfile
      register: dockerfile_status

    - name: Fail if Dockerfile does not exist
      ansible.builtin.fail:
        msg: "Dockerfile not found!"
      when: not dockerfile_status.stat.exists


    - name: build docker image
      docker_image:
        name: "{{docker_image }}"
        source: build  # <-- add
        build:         # <-- add
          path: /Users/obinna/Desktop/IU/DEVOP/webapp/  # <-- move under build:
        tag: latest

    - name: Log in to Docker Hub
      docker_login:
        username: "{{ docker_username }}"   # Your Docker Hub username
        password: "{{ docker_password }}"   # Your Docker Hub password

    - name: Push Docker image to Docker Hub
      docker_image:
        name: "{{ docker_username }}/{{ docker_image }}"   # Replace with your Docker Hub username and image name
        tag: latest
        push: yes
 
    


      
   
