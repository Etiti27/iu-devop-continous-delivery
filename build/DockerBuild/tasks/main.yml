---
# tasks file for DockerBuild
    # - name: Run Docker container
      # shell: |
        # apt update -y install
# /Users/obinna/Desktop/IU/DEVOP/build
   
      
 
    - name: Install Docker
      apt:
        name: docker.io
        state: present
      become: true

    - name: Install Ansible
      apt:
        name: ansible
        state: present
      become: true

   


    - name: Ensure Docker service is running
      service:
        name: docker
        state: started
        enabled: yes
      become: true

    # - name: Copy Dockerfile to remote host
      # copy:
        # src: /Users/obinna/Desktop/IU/DEVOP/Dockerfile
        # dest: /home/ubuntu/Dockerfile


  

    - name: Copy large file to remote host
      synchronize:
        src: /Users/obinna/Desktop/IU/DEVOP/webapp
        dest:  /home/ubuntu/
        rsync_opts:
          - "--compress"
          - "--progress"

    
    # - name: Build Docker image
    # - name: Build Docker image
      # docker_image:
        # path: "/home/ubuntu/webapp/"  # Directory containing the Dockerfile
        # name: "{{docker_image_name}}"            # Name of the Docker image
        # tag: "{{docker_image_tag}}"             # Optional: specify a tag
        # state: present 

    - name: Check if Dockerfile exists
      ansible.builtin.stat:
        path: /home/ubuntu/webapp/Dockerfile
      register: dockerfile_status

    - name: Fail if Dockerfile does not exist
      ansible.builtin.fail:
        msg: "Dockerfile not found!"
      when: not dockerfile_status.stat.exists

   
    # - name: Build Docker image
      # community.docker.docker_image:
      #  build:
        # context: /home/ubuntu/webapp/       # Directory containing the Dockerfile
        # dockerfile: Dockerfile                # Name of the Dockerfile (if not named 'Dockerfile')
      #  name: web-app         # Name of the Docker image
      #  tag: latest            # Optional: specify a tag
      #  state: present

    - name: Run Docker container
      shell: |
        docker build -t web-app:latest -f /home/ubuntu/webapp/ 

      # community.docker.docker_image:
        # path: "{{ docker_build_context }}"
        # name: "{{ docker_image_name }}"
        # tag: "{{ docker_image_tag }}"
      # become: true
    


      
    - name: Run Docker container
      shell: |
        docker run -d --name {{docker_image_name}} -p 3000:3000 {{ docker_image_name }}:{{ docker_image_tag }}
