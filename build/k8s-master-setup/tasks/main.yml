---
#setup master node


# ended here

- name: Pulling images required for setting up a Kubernetes cluster
  shell: kubeadm config images pull

- name: Initializing Kubernetes cluster
  shell: kubeadm init --apiserver-advertise-address {{ad_addr}} --pod-network-cidr={{cidr_v}}
  register: output


# - name: Initialize Kubernetes Cluster
#   shell: kubeadm init --pod-network-cidr=10.244.0.0/16
#   register: kubeadm_init
# # 
# - name: Create .kube directory
#   file:
#     path: /home/ubuntu/.kube
#     state: directory
#     owner: ubuntu
#     group: ubuntu
#     mode: '0755'

# - name: Copy Kube config
#   copy:
#     content: "{{ kubeadm_init.stdout_lines }}"
#     dest: /home/ubuntu/.kube/config
#     owner: ubuntu
#     group: ubuntu
#     mode: '0644'

# - name: Install Flannel Network Plugin
#   shell: kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
#   environment:
#     KUBECONFIG: /home/ubuntu/.kube/config

# - name: Retrieve kubeadm join token
#   shell: kubeadm token create --print-join-command
#   register: kubeadm_join_command

# - name: Save join command to file
#   copy:
#     ontent: "{{ kubeadm_join_command.stdout }}"
#     dest: /home/ubuntu/join_command.sh
#     mode: '0755'
